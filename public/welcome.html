<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan My Post - Bienvenue</title>
    <!-- SDK Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        :root {
            --neon-yellow: #E0FF00;
            --text-primary: #121821;
            --text-secondary: #4A5568;
            --bg-light: #f9fafb;
            --glass-bg: rgba(255, 255, 255, 0.82);
            --glass-border: rgba(0, 0, 0, 0.05);
            --card-shadow: rgba(50, 60, 70, 0.07);
            --card-hover-shadow: rgba(50, 60, 70, 0.14);
            --section-padding-vertical: 50px;
            --section-padding-horizontal: 30px;
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--bg-light);
            color: var(--text-primary);
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .scroll-section {
            padding: var(--section-padding-vertical) var(--section-padding-horizontal);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .deco-shape-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden; z-index: -1; pointer-events: none;
        }
        .deco-shape {
            position: absolute; background-color: var(--neon-yellow);
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            opacity: 0.07;
        }
        .s1 { width: 350px; height: 350px; top: 5%; left: -150px; animation: rotateBlob 25s linear infinite alternate; }
        .s2 { width: 250px; height: 250px; bottom: 10%; right: -120px; animation: rotateBlob 30s linear infinite; }
        .s3 { width: 180px; height: 180px; top: 15%; right: 2%; opacity: 0.06; animation: rotateBlob 20s linear infinite alternate-reverse; }
        .s4 { width: 280px; height: 280px; bottom: 0%; left: 5%; opacity: 0.08; animation: rotateBlob 35s linear infinite; }
        .s5 { width: 200px; height: 200px; top: 60%; left: -100px; opacity: 0.05; animation: rotateBlob 28s linear infinite alternate; }
        .s6 { width: 150px; height: 150px; bottom: 70%; right: -80px; opacity: 0.06; animation: rotateBlob 22s linear infinite; }
        .s7 { width: 300px; height: 300px; top: 30%; right: 20%; opacity: 0.04; animation: rotateBlob 40s linear infinite alternate-reverse; }
        .s8 { width: 120px; height: 120px; bottom: 25%; left: 30%; opacity: 0.07; animation: rotateBlob 18s linear infinite; }
        .s9 { width: 220px; height: 220px; top: -5%; left: 40%; opacity: 0.05; animation: rotateBlob 33s linear infinite alternate; }
        .s10 { width: 170px; height: 170px; bottom: -10%; right: 45%; opacity: 0.06; animation: rotateBlob 26s linear infinite; }

        @keyframes rotateBlob {
            from { transform: rotate(0deg) scale(1); }
            to   { transform: rotate(360deg) scale(1.03); }
        }

        .reveal-item {
            opacity: 0;
            transform: translateY(30px);
            transition-property: opacity, transform;
            transition-duration: 0.7s;
            transition-timing-function: var(--ease-out-expo);
        }
        .reveal-item.is-visible { opacity: 1; transform: translateY(0); }

        .delay-50 { transition-delay: 0.05s !important; } .delay-100 { transition-delay: 0.1s !important; }
        .delay-150 { transition-delay: 0.15s !important; } .delay-200 { transition-delay: 0.2s !important; }
        .delay-250 { transition-delay: 0.25s !important; } .delay-300 { transition-delay: 0.3s !important; }
        .delay-350 { transition-delay: 0.35s !important; } .delay-400 { transition-delay: 0.4s !important; }
        .delay-450 { transition-delay: 0.45s !important; } .delay-500 { transition-delay: 0.5s !important; }

        #hero {
            background: linear-gradient(140deg, #f0f4f8 0%, #e6eef5 100%);
            min-height: 95vh;
            z-index: 1;
        }

        .photo-ribbon-background {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            z-index: -2;
            pointer-events: none;
        }
        .photo-ribbon {
            display: flex;
            position: absolute;
            height: 25%;
            min-width: 200%;
            animation: scrollRibbon 40s linear infinite;
        }
        .photo-ribbon.reverse { animation-direction: reverse; animation-duration: 50s; }
        .photo-ribbon:nth-child(1) { top: 10%; animation-duration: 45s; }
        .photo-ribbon:nth-child(2) { top: 40%; animation-duration: 60s; opacity: 0.8; }
        .photo-ribbon:nth-child(3) { top: 70%; animation-duration: 35s; opacity: 0.9; }

        .photo-block {
            width: 15vw;
            min-width: 120px; max-width: 250px;
            height: 100%;
            background-color: rgba(180, 190, 200, 0.5);
            margin-right: 20px;
            border-radius: 8px;
            opacity: 0.3;
            background-size: cover;
            background-position: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .photo-block:nth-child(odd) { background-color: rgba(160, 170, 180, 0.55); }
        .photo-block:nth-child(3n) { filter: grayscale(30%); }


        @keyframes scrollRibbon {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-50%); }
        }

        .logo {
            width: 90px;
            margin-bottom: 22px;
            transform-origin: bottom center;
        }
        .logo.reveal-item { opacity: 0; transform: translateY(60px) scale(0.8); }
        .logo.reveal-item.is-visible { opacity: 1; transform: translateY(0) scale(1); }

        #hero h1 { font-size: 3.4em; font-weight: 800; margin-bottom: 18px; line-height: 1.18; position: relative; z-index: 1; }
        #hero h1 .highlight {
            color: var(--neon-yellow);
            text-shadow: 0 0 18px rgba(224, 255, 0, 0.5),
                         0 0 3px rgba(0,0,0,0.6);
        }
        #hero .subtitle { font-size: 1.38em; color: var(--text-secondary); margin-bottom: 40px; max-width: 780px; line-height: 1.7; position: relative; z-index: 1;}

        .cta-button-container {
            margin-top: 25px;
            position: relative;
            z-index: 1;
            min-height: 40px;
        }
        #googleSignInButtonDiv {
            display: inline-block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 25px;
        }
         .error-message {
            color: red;
            margin-top: 15px;
            font-weight: bold;
            font-size: 0.9em;
        }


        .scroll-down-arrow-link {
            display: block;
            margin: 40px auto 0 auto;
            width: 60px;
            height: 60px;
            cursor: pointer;
            z-index: 1;
            transition: transform 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
        }
        .scroll-down-arrow-link svg {
            width: 100%;
            height: 100%;
            fill: var(--neon-yellow);
            filter: drop-shadow(0 0 8px var(--neon-yellow)) drop-shadow(0 0 2px rgba(0,0,0,0.5));
            transition: filter 0.3s ease;
        }
        .scroll-down-arrow-link:hover {
            transform: translateY(8px);
        }
         .scroll-down-arrow-link:hover svg {
            filter: drop-shadow(0 0 12px var(--neon-yellow)) drop-shadow(0 0 3px rgba(0,0,0,0.6));
        }
        .scroll-down-arrow-link.reveal-item.is-visible {
            opacity: 1;
            transform: translateY(0);
        }


        .section-title {
            font-size: 2.6em; margin-bottom: 15px; color: var(--text-primary);
            position: relative; display: inline-block; padding-bottom: 10px;
        }
        .section-title .highlight {
            color: var(--neon-yellow);
            text-shadow: 0 0 12px rgba(224, 255, 0, 0.4),
                         0 0 2px rgba(0,0,0,0.5);
        }
        .section-title::after {
            content: ''; position: absolute; bottom: -2px; left: 50%;
            transform: translateX(-50%) scaleX(0); width: 65%; height: 3.5px;
            background-color: var(--neon-yellow); border-radius: 3px;
            transition: transform 0.55s var(--ease-out-expo) 0.3s;
        }
        .section-title.is-visible::after { transform: translateX(-50%) scaleX(1); }

        .section-intro {
            font-size: 1.15em; color: var(--text-secondary);
            max-width: 720px; margin: 0 auto 30px auto; line-height: 1.7;
        }

        .feature-card-wrapper {
            background: var(--glass-bg); backdrop-filter: blur(18px) saturate(170%);
            border: 1px solid var(--glass-border); border-radius: 22px; padding: 35px;
            box-shadow: 0 10px 38px var(--card-shadow); display: flex; align-items: center;
            gap: 40px; text-align: left;
            margin-bottom: 20px;
            transition: transform 0.3s var(--ease-out-expo), box-shadow 0.3s var(--ease-out-expo);
        }
        .feature-card-wrapper:hover {
            transform: translateY(-6px);
            box-shadow: 0 14px 45px var(--card-hover-shadow);
        }
        .feature-card-wrapper.reverse { flex-direction: row-reverse; }
        .feature-text-content { flex: 1.25; }
        .feature-text-content h3 {
            font-size: 1.8em; color: var(--neon-yellow);
            margin-top: 0; margin-bottom: 15px; font-weight: 700;
            text-shadow: 0 1px 3px rgba(0,0,0,0.15),
                         0 0 12px rgba(224,255,0,0.35);
        }
        .feature-text-content p { font-size: 1.03em; color: var(--text-secondary); line-height: 1.7; }

        .feature-visual {
            flex-basis: 380px; min-width: 300px; height: 300px;
            background-color: rgba(238, 242, 247, 0.85);
            border-radius: 16px; display: flex; align-items: center; justify-content: center;
            position: relative; border: 1px solid rgba(0,0,0,0.035);
            transform-style: preserve-3d; box-shadow: inset 0 0 12px rgba(0,0,0,0.02);
        }

        #gallery-visual .photo-icon {
            width: 72px; height: 58px; background-color: #b5c5d6;
            border-radius: 5px; position: absolute; opacity: 0;
            transform: translateY(20px) scale(0.7) rotate(-5deg);
            transition-property: opacity, transform;
            transition-timing-function: ease-out, var(--ease-out-back);
            box-shadow: 0 2px 8px rgba(0,0,0,0.09);
            display: flex; align-items: center; justify-content: center;
        }
        #gallery-visual.is-visible .photo-icon { opacity: 1; }
        #gallery-visual.is-visible .photo-icon:nth-child(1) { transition-duration: 0.4s, 0.5s; transform: translate(-65px, -38px) rotate(-12deg) scale(1); transition-delay: 0.1s; }
        #gallery-visual.is-visible .photo-icon:nth-child(2) { transition-duration: 0.4s, 0.5s; transform: translate(0px, 8px) rotate(8deg) scale(1.1); transition-delay: 0.2s; }
        #gallery-visual.is-visible .photo-icon:nth-child(3) { transition-duration: 0.4s, 0.5s; transform: translate(70px, -32px) rotate(18deg) scale(0.95); transition-delay: 0.3s; }

        #gallery-visual .photo-icon .exif-tag {
            opacity: 0; font-size: 0.6em; background-color: rgba(0,0,0,0.55); color: white;
            padding: 2px 4px; border-radius: 3px; position: absolute; bottom: 4px; right: 4px;
            transform: translateY(4px);
            transition: opacity 0.3s ease-out 0.3s, transform 0.3s ease-out 0.3s;
        }
        #gallery-visual.is-visible .photo-icon:nth-child(2) .exif-tag { opacity: 1; transform: translateY(0px); transition-delay: 0.6s; }

        /* --- Section Édition --- */
        #edit-visual .edit-base-image {
            width: 120px; height: 150px; background-color: #b0c0d0; border-radius: 8px;
            position: relative;
            overflow: hidden;
            display: flex; flex-direction: column;
            transform-style: preserve-3d;
            transition: filter 0.3s ease-out;
        }
        #edit-visual .edit-base-image .segment {
            flex-grow: 1; background-color: #b0c0d0;
            border-bottom: 1px dashed rgba(255,255,255,0.3);
            transform: translateZ(0px) translateY(0px) rotateX(0deg);
            transition: transform 0.4s var(--ease-out-back) 0.2s;
        }
        #edit-visual .edit-base-image .segment:last-child { border-bottom: none; }

        #edit-visual.is-visible .edit-base-image.split { filter: brightness(0.95); }
        #edit-visual.is-visible .edit-base-image.split .segment:nth-child(1) { transform: translateZ(5px) translateY(-6px) rotateX(6deg); }
        #edit-visual.is-visible .edit-base-image.split .segment:nth-child(3) { transform: translateZ(5px) translateY(6px) rotateX(-6deg); }

        #edit-visual .crop-box-animator {
            position: absolute;
            top: 8px; left: 8px;
            width: calc(100% - 16px);
            height: calc(100% - 16px);
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }
        #edit-visual.is-visible .crop-box-animator {
            opacity: 1;
            animation: shrinkExpandCropBox 2.5s var(--ease-out-back) infinite 0.5s;
        }

        @keyframes shrinkExpandCropBox {
            0%, 100% {
                top: 8px; left: 8px;
                width: calc(100% - 16px); height: calc(100% - 16px);
            }
            40% {
                top: 30px; left: 30px;
                width: calc(100% - 60px); height: calc(100% - 60px);
            }
            60% {
                top: 4px; left: 4px;
                width: calc(100% - 8px); height: calc(100% - 8px);
            }
        }

        #edit-visual .crop-box-animator .crop-line {
            position: absolute; background-color: var(--neon-yellow);
            box-shadow: 0 0 5px rgba(224,255,0,0.55);
        }
        #edit-visual .crop-box-animator .crop-line.top { top: 0; left: 0; width: 100%; height: 3.5px; }
        #edit-visual .crop-box-animator .crop-line.bottom { bottom: 0; left: 0; width: 100%; height: 3.5px; }
        #edit-visual .crop-box-animator .crop-line.left { top: 0; left: 0; width: 3.5px; height: 100%; }
        #edit-visual .crop-box-animator .crop-line.right { top: 0; right: 0; width: 3.5px; height: 100%; }

        /* --- Section Planning --- */
        #planning-visual .calendar-grid-bg {
            width: 190px; height: 150px; background-color: rgba(230,235,240,0.9);
            border: 2px solid #c8d0d8; padding: 7px; border-radius: 7px;
            display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);
            gap: 6px; transform: scale(0.85) rotateY(20deg) translateY(10px); opacity: 0;
            transition: transform 0.55s var(--ease-out-expo) 0.1s, opacity 0.45s ease-out 0.1s;
        }
        #planning-visual.is-visible .calendar-grid-bg { transform: scale(1) rotateY(0deg) translateY(0px); opacity: 1; }

        @keyframes pulseCalendarCell {
            0%, 100% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.15) translateY(-5px); }
        }

        #planning-visual .calendar-cell-item {
            border-radius: 4px; box-shadow: 0 1px 5px rgba(0,0,0,0.1); opacity: 0;
            transform: translateY(-20px) scale(0.6) rotateX(20deg);
            transition: opacity 0.3s ease-out, transform 0.35s var(--ease-out-back);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8em; font-weight: 600; color: var(--text-primary);
        }
        #planning-visual.is-visible .calendar-cell-item { opacity: 1; transform: translateY(0) scale(1) rotateX(0deg); }

        #planning-visual.is-visible .calendar-cell-item:nth-child(1) { transition-delay: 0.35s; background-color: #FFB0B0; animation: pulseCalendarCell 2.8s ease-in-out infinite 0.5s; }
        #planning-visual.is-visible .calendar-cell-item:nth-child(2) { transition-delay: 0.45s; background-color: #B0E0E6; }
        #planning-visual.is-visible .calendar-cell-item:nth-child(3) { transition-delay: 0.55s; background-color: #FFFACD; animation: pulseCalendarCell 2.8s ease-in-out infinite 0.65s; }
        #planning-visual.is-visible .calendar-cell-item:nth-child(4) { transition-delay: 0.65s; background-color: #D8BFD8; }
        #planning-visual.is-visible .calendar-cell-item:nth-child(5) { transition-delay: 0.7s; background-color: var(--neon-yellow); animation: pulseCalendarCell 2.8s ease-in-out infinite 0.8s; }
        #planning-visual.is-visible .calendar-cell-item:nth-child(6) { transition-delay: 0.75s; background-color: #B0E0E6; }
        #planning-visual.is-visible .calendar-cell-item:nth-child(7) { transition-delay: 0.8s; background-color: #D8BFD8; animation: pulseCalendarCell 2.8s ease-in-out infinite 0.95s;}
        #planning-visual.is-visible .calendar-cell-item:nth-child(8) { transition-delay: 0.82s; background-color: #FFFACD; }
        #planning-visual.is-visible .calendar-cell-item:nth-child(9) { transition-delay: 0.85s; background-color: var(--neon-yellow); animation: pulseCalendarCell 2.8s ease-in-out infinite 1.1s;}

        #target-audience { background-color: var(--bg-light); }
        .audience-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(255px, 1fr));
            gap: 28px; max-width: 1050px; width: 100%; margin-top: 25px;
        }
        .audience-card {
            background: var(--glass-bg); padding: 28px; border-radius: 18px;
            border: 1px solid var(--glass-border); box-shadow: 0 7px 20px var(--card-shadow);
            transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;
        }
        .audience-card:hover { transform: translateY(-4px); box-shadow: 0 10px 25px var(--card-hover-shadow); }
        .audience-card svg { width: 38px; height: 38px; margin-bottom: 12px; color: var(--neon-yellow); filter: drop-shadow(0 1px 2px rgba(0,0,0,0.08)); }
        .audience-card h4 { font-size: 1.25em; margin: 0 0 10px 0; color: var(--text-primary); font-weight: 600; }
        .audience-card p { font-size: 0.9em; color: var(--text-secondary); line-height: 1.6; margin:0; }

        .testimonial-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(290px, 1fr));
            gap: 30px; max-width: 1050px; width: 100%; margin-top: 25px;
        }
        .testimonial-card {
            background: var(--glass-bg); padding: 30px 35px; border-radius: 20px;
            border: 1px solid var(--glass-border); box-shadow: 0 8px 28px var(--card-shadow);
            text-align: left; position: relative;
             transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;
        }
        .testimonial-card:hover { transform: translateY(-5px); box-shadow: 0 12px 35px var(--card-hover-shadow); }
        .testimonial-card::before {
            content: '“'; font-size: 5.5em; color: var(--neon-yellow); opacity: 0.35;
            position: absolute; top: -8px; left: 12px; line-height: 1; z-index: 0;
        }
        .testimonial-card p.quote { font-style: italic; font-size: 1.08em; line-height: 1.7; margin: 12px 0 20px 0; position: relative; z-index: 1; }
        .testimonial-card p.author { font-weight: 700; color: var(--text-primary); font-size: 1.05em; }
        .testimonial-card span.role { font-size: 0.88em; color: var(--text-secondary); display: block; }

        #intro-dots-animation { background-color: #eef2f5; }
        #how-it-works-section { background-color: var(--bg-light); }

        #how-it-works-section .section-title,
        #intro-dots-animation .section-title { font-size: 2.5em; margin-bottom: 15px; }

        #dots-animation-container,
        #intro-dots-visual {
            width: 400px; height: 230px; margin: 18px auto;
            border: 1px solid var(--glass-border);
            background-color: rgba(255,255,255,0.6);
            border-radius: 16px; box-shadow: 0 5px 18px rgba(0,0,0,0.06);
            position: relative;
        }

        .dot, .square-anim {
            position: absolute;
            opacity: 0;
            box-shadow: 0 1px 2.5px rgba(0,0,0,0.1);
        }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .square-anim { width: 12px; height: 12px; border-radius: 2px; }

        .steps-container {
            display: flex; justify-content: space-around; flex-wrap: wrap;
            gap: 28px; max-width: 1050px; margin-top: 20px; text-align: left;
        }
        .step-card {
            flex: 1; min-width: 250px; max-width: 310px;
            padding: 28px; background: var(--glass-bg);
            border-radius: 16px; border: 1px solid var(--glass-border);
            box-shadow: 0 6px 18px var(--card-shadow);
            transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;
        }
        .step-card:hover { transform: translateY(-4px); box-shadow: 0 9px 25px var(--card-hover-shadow); }
        .step-card strong { font-size: 1.25em; color: var(--text-primary); margin-bottom: 10px; font-weight: 600; display: block;}
        .step-card p { font-size: 0.92em; color: var(--text-secondary); line-height: 1.6; }

        #final-cta { background: linear-gradient(140deg, #e9f1f8 0%, #dde6ed 100%); }
        #final-cta .section-title { font-size: 2.5em; }
        #final-cta .section-intro { font-size: 1.25em; }

        @media (max-width: 992px) {
            .feature-card-wrapper { flex-direction: column !important; padding: 30px 25px; gap: 25px; }
            .feature-visual { width: 100%; max-width: 330px; height: 270px; margin-bottom: 20px; }
            .section-title { font-size: 2.3em; } .section-intro { font-size: 1.05em; }
            .photo-block { width: 20vw; min-width: 100px; max-width: 200px; }
            .photo-ribbon { height: 20%; }
             .scroll-down-arrow-link { width: 50px; height: 50px; margin-top: 30px;}
        }
        @media (max-width: 768px) {
            .scroll-section { padding: 40px 15px; }
            #hero { min-height: 90vh; }
            #hero h1 { font-size: 2.3em; } #hero .subtitle { font-size: 1.1em; }
            .scroll-down-arrow-link { width: 45px; height: 45px; margin-top: 25px; }
            .section-title { font-size: 2em; } .section-intro { font-size: 0.95em; margin-bottom: 25px;}
            .feature-text-content h3 { font-size: 1.45em; } .feature-text-content p { font-size: 0.9em; }
            #dots-animation-container, #intro-dots-visual { width: 90%; height: 180px; }
            .dot, .square-anim { width: 10px; height: 10px; }
            .steps-container { flex-direction: column; align-items: center; gap: 18px; }
            .step-card { min-width: 85%; max-width: 95%; padding: 20px; }
            #googleSignInButtonDiv { max-width: 100%; }
            .audience-card h4 {font-size: 1.1em;} .audience-card p {font-size: 0.85em;}
            .testimonial-card p.quote {font-size: 0.95em;}
            .photo-block { width: 25vw; min-width: 80px; max-width: 150px; margin-right: 15px;}
            .photo-ribbon { height: 18%; }
        }

    </style>
</head>
<body>

    <section id="hero" class="scroll-section">
        <div class="photo-ribbon-background">
            <div class="photo-ribbon">
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum1/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum2/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum3/300/200');"></div>
                <div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum1/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum2/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum3/300/200');"></div>
                <div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div>
            </div>
            <div class="photo-ribbon reverse">
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum4/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum5/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum6/300/200');"></div>
                <div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum4/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum5/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum6/300/200');"></div>
                <div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div>
            </div>
            <div class="photo-ribbon">
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum7/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum8/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum9/300/200');"></div>
                <div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum7/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum8/300/200');"></div>
                <div class="photo-block" style="background-image: url('https://picsum.photos/seed/picsum9/300/200');"></div>
                <div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div><div class="photo-block"></div>
            </div>
        </div>

        <div class="deco-shape-container">
            <div class="deco-shape s1" data-parallax-speed="0.12"></div>
            <div class="deco-shape s2" data-parallax-speed="-0.08"></div>
            <div class="deco-shape s9" data-parallax-speed="0.05"></div>
        </div>
        <img src="assets/logo.png" alt="Plan My Post Logo" class="logo reveal-item">
        <h1 class="reveal-item delay-100">De l'idée à l'<span class="highlight">impact</span> : simplifiez votre création.</h1>
        <p class="subtitle reveal-item delay-200">
            Gagnez des heures précieuses chaque semaine, publiez avec une constance professionnelle et oubliez le stress de la dernière minute. Plan My Post est votre cockpit créatif tout-en-un.
        </p>

        <div class="cta-button-container reveal-item delay-300">
            <div id="googleSignInButtonDiv"></div>
            <p id="authErrorMessage" class="error-message" style="display:none;"></p>
        </div>

        <a href="#intro-dots-animation" class="scroll-down-arrow-link reveal-item delay-400" aria-label="Faire défiler vers le bas">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 4h2v10l4.5-4.5 1.5 1.5L12 18l-7-7 1.5-1.5L11 14V4z"/>
            </svg>
        </a>
    </section>

    <section id="intro-dots-animation" class="scroll-section">
        <div class="deco-shape-container">
             <div class="deco-shape s3" data-parallax-speed="0.09" style="width:220px; height:220px; top:8%; left:2%; opacity:0.05;"></div>
             <div class="deco-shape s4" data-parallax-speed="-0.06" style="width:280px; height:280px; bottom:8%; right:-5%; opacity:0.06;"></div>
             <div class="deco-shape s10" data-parallax-speed="0.07"></div>
        </div>
        <h2 class="section-title reveal-item">Du chaos initial à la <span class="highlight">stratégie claire</span></h2>
        <p class="section-intro reveal-item delay-100">
            Visualisez la puissance de l'organisation. Plan My Post rassemble vos idées éparses, vos images multiples et vos inspirations en un plan d'action structuré et prêt à performer.
        </p>
        <div id="intro-dots-visual" class="reveal-item delay-200">
        </div>
    </section>

    <section id="feature-galleries" class="scroll-section">
        <div class="deco-shape-container">
             <div class="deco-shape s1" data-parallax-speed="0.1" style="opacity:0.07; transform: scale(0.85) rotate(20deg); top:10%; left:-120px;"></div>
             <div class="deco-shape s5" data-parallax-speed="-0.07"></div>
        </div>
        <div class="feature-container">
            <h2 class="section-title reveal-item">Vos images, <span class="highlight">accessibles & organisées</span></h2>
            <p class="section-intro reveal-item delay-100">
                Ne laissez plus vos meilleures idées visuelles se perdre. Centralisez, retrouvez et préparez vos images sans effort.
            </p>
            <div class="feature-card-wrapper reveal-item delay-150">
                <div class="feature-text-content">
                    <h3 class="reveal-item delay-250">Galeries intelligentes et centralisées</h3>
                    <p class="reveal-item delay-350">Vos images, parfaitement rangées. Créez des galeries par projet ou par thème. L'import en masse et la lecture des dates EXIF vous font gagner un temps précieux. Suivez facilement les versions originales et celles que vous avez optimisées.</p>
                </div>
                <div class="feature-visual reveal-item delay-200" id="gallery-visual">
                </div>
            </div>
        </div>
    </section>

    <section id="feature-editing" class="scroll-section">
         <div class="deco-shape-container">
            <div class="deco-shape s2" data-parallax-speed="-0.09" style="opacity:0.07; transform: scale(0.95) rotate(-30deg); bottom:5%; right:-100px"></div>
            <div class="deco-shape s6" data-parallax-speed="0.08"></div>
        </div>
        <div class="feature-container">
            <h2 class="section-title reveal-item">Des posts impeccables, <span class="highlight">sans effort</span></h2>
             <p class="section-intro reveal-item delay-100">
                Transformez vos images brutes en publications prêtes à engager, sans quitter l'application.
            </p>
            <div class="feature-card-wrapper reverse reveal-item delay-150">
                <div class="feature-text-content">
                    <h3 class="reveal-item delay-250">Composition & préparation intégrées</h3>
                    <p class="reveal-item delay-350">Créez des "Jours" (vos publications) en un clin d'œil. Recadrez au format idéal (4:5, carré), ajoutez des barres blanches pour un style pro, ou splitez vos images pour des carrousels dynamiques. Descriptions ? Directement sous la main.</p>
                </div>
                <div class="feature-visual reveal-item delay-200" id="edit-visual">
                    <div class="edit-base-image">
                        <div class="segment"></div><div class="segment"></div><div class="segment"></div>
                        <div class="crop-box-animator">
                            <div class="crop-line top"></div><div class="crop-line bottom"></div>
                            <div class="crop-line left"></div><div class="crop-line right"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="feature-planning" class="scroll-section">
         <div class="deco-shape-container">
            <div class="deco-shape s3" data-parallax-speed="0.11" style="opacity:0.06; top: 5%; right: -50px"></div>
            <div class="deco-shape s7" data-parallax-speed="-0.05"></div>
        </div>
        <div class="feature-container">
            <h2 class="section-title reveal-item">Visualisez votre <span class="highlight">stratégie</span></h2>
             <p class="section-intro reveal-item delay-100">
                Anticipez, ajustez, et publiez avec confiance. Votre calendrier éditorial, enfin sous contrôle.
            </p>
            <div class="feature-card-wrapper reveal-item delay-150">
                <div class="feature-text-content">
                    <h3 class="reveal-item delay-250">Calendrier intelligent & flexible</h3>
                    <p class="reveal-item delay-350">Notre calendrier interactif vous donne le contrôle. Glissez-déposez vos "Jours", visualisez votre planning, et adaptez-le en un instant. Fini le stress des publications de dernière minute, bonjour la proactivité.</p>
                </div>
                <div class="feature-visual reveal-item delay-200" id="planning-visual">
                    <div class="calendar-grid-bg">
                        <div class="calendar-cell-item">A</div><div class="calendar-cell-item"></div><div class="calendar-cell-item">B</div>
                        <div class="calendar-cell-item"></div><div class="calendar-cell-item">C</div><div class="calendar-cell-item"></div>
                        <div class="calendar-cell-item">D</div><div class="calendar-cell-item"></div><div class="calendar-cell-item">E</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="target-audience" class="scroll-section">
        <div class="deco-shape-container">
            <div class="deco-shape s4" data-parallax-speed="-0.07" style="opacity:0.05; bottom: 2%; left: -80px;"></div>
            <div class="deco-shape s8" data-parallax-speed="0.06"></div>
        </div>
        <h2 class="section-title reveal-item">Conçu pour les <span class="highlight">créateurs exigeants</span></h2>
        <p class="section-intro reveal-item delay-100">
            Que vous soyez un loup solitaire de la création ou une équipe agile, Plan My Post s'adapte à vos ambitions.
        </p>
        <div class="audience-grid">
            <div class="audience-card reveal-item delay-200">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                <h4>Créateurs & indépendants</h4>
                <p>Maximisez votre impact créatif sans sacrifier votre temps. Concentrez-vous sur l'essence, nous gérons le flux.</p>
            </div>
            <div class="audience-card reveal-item delay-300">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                <h4>Community managers</h4>
                <p>Jonglez avec aisance entre plusieurs comptes, orchestrez des campagnes complexes et gardez une vision claire de votre stratégie éditoriale.</p>
            </div>
            <div class="audience-card reveal-item delay-400">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/></svg>
                <h4>Petites entreprises & marques</h4>
                <p>Établissez une présence en ligne professionnelle et constante, même avec des ressources limitées. Votre image de marque, sublimée.</p>
            </div>
        </div>
    </section>

    <section id="how-it-works-section" class="scroll-section">
        <div class="deco-shape-container">
            <div class="deco-shape s1" data-parallax-speed="0.1" style="top:70%; left:10%; transform:scale(0.7) rotate(-40deg)"></div>
            <div class="deco-shape s6" data-parallax-speed="-0.08" style="bottom:75%; right:5%; transform:scale(0.8)"></div>
        </div>
        <h2 class="section-title reveal-item">Un processus <span class="highlight">intuitif</span></h2>
        <p class="section-intro reveal-item delay-100">
           De l'inspiration initiale à la publication finale, découvrez un flux de travail optimisé.
        </p>
        <div id="dots-animation-container" class="reveal-item delay-200">
        </div>
        <div class="steps-container">
            <div class="step-card reveal-item delay-300">
                <strong>1. Importez & inspirez</strong>
                <p>Rassemblez vos images dans des Galeries. Laissez-vous surprendre par les dates EXIF pour retrouver des pépites oubliées.</p>
            </div>
            <div class="step-card reveal-item delay-400">
                <strong>2. Composez & ciblez</strong>
                <p>Créez vos "Jours" : sélectionnez vos visuels, affinez-les avec nos outils, et rédigez des messages qui parlent à votre audience.</p>
            </div>
            <div class="step-card reveal-item delay-500">
                <strong>3. Planifiez & rayonnez</strong>
                <p>Positionnez vos "Jours" sur le calendrier. Votre contenu est prêt à briller, au bon moment, sans effort de dernière minute.</p>
            </div>
        </div>
    </section>

    <section id="testimonials" class="scroll-section">
        <div class="deco-shape-container">
            <div class="deco-shape s1" data-parallax-speed="0.09" style="width:220px; height:220px; top: 65%; right:-60px; opacity: 0.05;"></div>
            <div class="deco-shape s3" data-parallax-speed="-0.11" style="width:260px; height:260px; bottom: 5%; left:-100px; opacity: 0.06;"></div>
        </div>
        <h2 class="section-title reveal-item">Ce qu'ils disent de <span class="highlight">Plan My Post</span></h2>
        <p class="section-intro reveal-item delay-100">
            Découvrez comment Plan My Post a simplifié et dynamisé le quotidien de créateurs comme vous.
        </p>
        <div class="testimonial-grid">
            <div class="testimonial-card reveal-item delay-200">
                <p class="quote">"Plan My Post a littéralement changé ma façon de travailler. L'organisation en 'Jours' et le calendrier visuel sont des game-changers. Je gagne un temps fou !"</p>
                <p class="author">Léa D.</p><span class="role">Créatrice de contenu lifestyle</span>
            </div>
            <div class="testimonial-card reveal-item delay-300">
                <p class="quote">"La fonction de recadrage et de préparation des images pour les carrousels est incroyablement intuitive. Mes posts Instagram n'ont jamais été aussi soignés."</p>
                <p class="author">Marc V.</p><span class="role">Social media manager freelance</span>
            </div>
            <div class="testimonial-card reveal-item delay-400">
                <p class="quote">"Enfin un outil qui comprend les besoins des PME ! Simple, efficace, et ça m'aide à maintenir une présence constante sans y passer mes journées."</p>
                <p class="author">Sophie K.</p><span class="role">Gérante d'une boutique en ligne</span>
            </div>
        </div>
    </section>

    <section id="final-cta" class="scroll-section">
        <div class="deco-shape-container">
             <div class="deco-shape s1" data-parallax-speed="0.08" style="opacity:0.07; transform: scale(0.95) rotate(50deg); top: 45%; left: -160px;"></div>
             <div class="deco-shape s2" data-parallax-speed="-0.06" style="opacity:0.07; transform: scale(1.05) rotate(-35deg); bottom: -40px; right: -130px;"></div>
        </div>
        <h2 class="section-title reveal-item">Prêt à créer sans contraintes ?</h2>
        <p class="section-intro reveal-item delay-100">
            Rejoignez la communauté des créateurs qui ont choisi la sérénité et l'efficacité. Plan My Post vous attend.
        </p>
        <div class="cta-button-container reveal-item delay-200">
             <div id="googleSignInButtonDivFinalCta"></div>
        </div>
    </section>

<script>
    // ID Client Google OAuth
    const GOOGLE_CLIENT_ID = '20504385379-1fkmerpv5kdohra8u2bt892kn1bmehhe.apps.googleusercontent.com';

    async function handleCredentialResponse(response) {
        const errorMsgEl = document.getElementById('authErrorMessage');
        try {
            const idToken = response.credential;

            // Envoyer le token au backend pour vérification
            const res = await fetch('/api/auth/google-signin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ token: idToken }),
            });

            if (!res.ok) {
                const errorData = await res.json().catch(() => ({ message: 'Une erreur inconnue est survenue.' }));
                throw new Error(errorData.message || `Le serveur a répondu avec le statut ${res.status}`);
            }

            const { user } = await res.json();

            window.location.href = '/index.html'; // Rediriger vers l'application principale

        } catch (error) {
            console.error("Erreur lors de la connexion:", error);
            if(errorMsgEl) {
                errorMsgEl.textContent = `Erreur de connexion: ${error.message}. Veuillez réessayer.`;
                errorMsgEl.style.display = 'block';
            }
        }
    }

    window.onload = function () {
        if (GOOGLE_CLIENT_ID.startsWith('xxxxxxxx-xxxxxxxx')) {
            const errorMsgEl = document.getElementById('authErrorMessage');
            if(errorMsgEl) {
                errorMsgEl.textContent = "Erreur de configuration : ID Client Google manquant.";
                errorMsgEl.style.display = 'block';
            }
            console.error("ERREUR: Veuillez configurer votre ID Client Google dans le script de welcome.html");
            const heroButtonDiv = document.getElementById('googleSignInButtonDiv');
            if (heroButtonDiv) heroButtonDiv.style.display = 'none';
            const finalCtaButtonDiv = document.getElementById('googleSignInButtonDivFinalCta');
            if (finalCtaButtonDiv) finalCtaButtonDiv.style.display = 'none';
        } else {
            google.accounts.id.initialize({
                client_id: GOOGLE_CLIENT_ID,
                callback: handleCredentialResponse,
                auto_select: false
            });

            const heroButtonDiv = document.getElementById('googleSignInButtonDiv');
            if (heroButtonDiv) {
                google.accounts.id.renderButton(
                    heroButtonDiv,
                    { theme: 'outline', size: 'large', type: 'standard', text: 'continue_with', shape: 'pill', logo_alignment: 'left' }
                );
            }
            
            const finalCtaButtonDiv = document.getElementById('googleSignInButtonDivFinalCta');
            if (finalCtaButtonDiv) {
                 google.accounts.id.renderButton(
                    finalCtaButtonDiv,
                    { theme: 'filled_black', size: 'large', type: 'standard', text: 'continue_with', shape: 'pill', logo_alignment: 'left' }
                );
            }
        }

        const observerOptions = {
            root: null,
            rootMargin: '0px 0px -10% 0px',
            threshold: 0.01
        };

        const revealIntersectionObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.reveal-item').forEach(el => {
            revealIntersectionObserver.observe(el);
        });

        const parallaxShapes = document.querySelectorAll('.deco-shape');
        if (parallaxShapes.length > 0) {
            let lastScrollY = window.pageYOffset;
            let ticking = false;
            function handleParallax() {
                parallaxShapes.forEach(shape => {
                    const parentSection = shape.closest('.scroll-section');
                    if (parentSection) {
                        const rect = parentSection.getBoundingClientRect();
                        if (rect.top < window.innerHeight * 1.1 && rect.bottom > -window.innerHeight * 0.1) {
                            const speed = parseFloat(shape.dataset.parallaxSpeed) || 0.1;
                            const movement = (lastScrollY - (parentSection.offsetTop + parentSection.offsetHeight / 2 - window.innerHeight / 2)) * speed * -0.2;
                            shape.style.transform = `translateY(${movement}px)`;
                        }
                    }
                });
                ticking = false;
            }
            window.addEventListener('scroll', () => {
                lastScrollY = window.pageYOffset;
                if (!ticking) {
                    window.requestAnimationFrame(handleParallax);
                    ticking = true;
                }
            }, { passive: true });
            if (parallaxShapes.length > 0) handleParallax();
        }

        document.querySelectorAll('.photo-ribbon').forEach(ribbon => {
            const blocks = Array.from(ribbon.children);
            blocks.forEach(block => {
                ribbon.appendChild(block.cloneNode(true));
            });
        });

        const galleryVisualEl = document.getElementById('gallery-visual');
        if (galleryVisualEl) {
            for (let i = 0; i < 3; i++) {
                const photoIcon = document.createElement('div');
                photoIcon.classList.add('photo-icon');
                 if (i === 1) {
                    const exifTag = document.createElement('span');
                    exifTag.classList.add('exif-tag');
                    exifTag.textContent = "EXIF";
                    photoIcon.appendChild(exifTag);
                }
                galleryVisualEl.appendChild(photoIcon);
            }
        }

        const editVisualParentCardEl = document.querySelector('#feature-editing .feature-card-wrapper');
        const editBaseImageEl = document.querySelector('#edit-visual .edit-base-image');
        if (editVisualParentCardEl && editBaseImageEl) {
            const editCardSpecificObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const editVisualEl = document.getElementById('edit-visual');
                    if (entry.isIntersecting && editVisualEl && editVisualEl.classList.contains('is-visible')) {
                        setTimeout(() => {
                            if (editVisualEl.classList.contains('is-visible')) {
                                editBaseImageEl.classList.add('split');
                            }
                        }, 600);
                    } else {
                        editBaseImageEl.classList.remove('split');
                    }
                });
            }, { threshold: 0.45 });
            editCardSpecificObserver.observe(editVisualParentCardEl);
        }

        function setupAnimatedElements(containerId, numElementsParam, elementColorsParam, elementType = "dot") {
            const elementsContainer = document.getElementById(containerId);
            if (!elementsContainer) return;

            let elements = [];
            let areElementsOrganized = false;
            let isMixedState = false;
            let animationTimeout, mixTimeout;

            const createElementDOMNodes = () => {
                elementsContainer.innerHTML = '';
                elements = [];
                for (let i = 0; i < numElementsParam; i++) {
                    const el = document.createElement('div');
                    el.classList.add(elementType === 'square' ? 'square-anim' : 'dot');
                    el.style.backgroundColor = elementColorsParam[i % elementColorsParam.length];
                    elementsContainer.appendChild(el);
                    elements.push(el);
                }
            };

            const resetElementsLayout = (instant = false) => {
                if (elements.length === 0 || !elementsContainer) return;
                const cw = elementsContainer.offsetWidth;
                const ch = elementsContainer.offsetHeight;
                const itemSize = elements[0] ? elements[0].offsetWidth : 12;

                elements.forEach(el => {
                    if (instant) el.style.transition = 'none';
                    else el.style.transition = `transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.4s ease-out`;

                    el.style.opacity = '0';
                    el.style.transform = `translate(${Math.random() * (cw - itemSize)}px, ${Math.random() * (ch - itemSize)}px) scale(0.3)`;
                });
                areElementsOrganized = false;
                isMixedState = false;
                clearTimeout(mixTimeout);
            };

            const animateElementsMixedLayout = () => {
                if (elements.length === 0 || !elementsContainer || elementsContainer.offsetWidth === 0 || elementsContainer.offsetHeight === 0) return;
                if (areElementsOrganized || isMixedState) return;

                isMixedState = true;
                const cw = elementsContainer.offsetWidth;
                const ch = elementsContainer.offsetHeight;
                const itemSize = elements[0] ? elements[0].offsetWidth : 12;
                const padding = 15;
                const availableWidth = cw - 2 * padding;
                const availableHeight = ch - 2 * padding;
                const itemsPerRow = Math.floor(availableWidth / (itemSize + 5));

                elements.forEach((el, index) => {
                    const rowIndex = Math.floor(index / itemsPerRow);
                    const colIndex = index % itemsPerRow;

                    const targetX = padding + colIndex * (itemSize + 5) + (availableWidth - itemsPerRow * (itemSize+5))/2;
                    const targetY = padding + rowIndex * (itemSize + 5) + (availableHeight - Math.ceil(elements.length/itemsPerRow) * (itemSize+5))/2;

                    void el.offsetWidth;
                    el.style.transition = `transform 0.8s var(--ease-out-back) ${index * 0.015}s, opacity 0.5s ease-out ${index * 0.015}s`;
                    el.style.transform = `translate(${targetX}px, ${targetY}px) scale(1)`;
                    el.style.opacity = '1';
                });
            };

            const animateElementsOrganizedLayout = () => {
                if (elements.length === 0 || !elementsContainer || elementsContainer.offsetWidth === 0 || elementsContainer.offsetHeight === 0) {
                     areElementsOrganized = false; return;
                }
                if (areElementsOrganized && elementType !== 'square') return;
                if (areElementsOrganized && elementType === 'square' && !isMixedState) return;

                areElementsOrganized = true;
                isMixedState = false;

                const cw = elementsContainer.offsetWidth;
                const ch = elementsContainer.offsetHeight;
                const elementsPerColor = {};
                elements.forEach(el => {
                    const color = el.style.backgroundColor;
                    if (!elementsPerColor[color]) elementsPerColor[color] = [];
                    elementsPerColor[color].push(el);
                });
                const numColorGroups = Object.keys(elementsPerColor).length;
                if (numColorGroups === 0) { areElementsOrganized = false; return; }

                const groupMinHeight = 40;
                const totalMinHeightForAllGroups = numColorGroups * groupMinHeight;
                const effectiveCh = Math.max(ch, totalMinHeightForAllGroups);
                const groupHeight = effectiveCh / numColorGroups;
                const padding = 15;
                const availableWidth = cw - 2 * padding;
                let yCursor = padding + (ch < totalMinHeightForAllGroups ? (totalMinHeightForAllGroups - ch) / -2 : 0);

                Object.values(elementsPerColor).forEach((group) => {
                    const elementsInGroup = group.length;
                    const itemSize = elements[0] ? elements[0].offsetWidth : 12;
                    const itemSpacing = Math.max(2, Math.floor(itemSize * 0.5));
                    const maxItemsPerRow = Math.max(1, Math.floor((availableWidth + itemSpacing) / (itemSize + itemSpacing)));
                    const numRows = Math.ceil(elementsInGroup / maxItemsPerRow);
                    const rowHeightWithSpacing = itemSize + itemSpacing;
                    const totalHeightOfRowsInGroup = numRows * rowHeightWithSpacing - (numRows > 0 ? itemSpacing : 0);
                    const groupContentStartY = yCursor + (groupHeight / 2) - (totalHeightOfRowsInGroup / 2);

                    group.forEach((el, index) => {
                        const rowIndex = Math.floor(index / maxItemsPerRow);
                        const colIndex = index % maxItemsPerRow;
                        const itemsInCurrentRow = (rowIndex === numRows - 1) ? (elementsInGroup % maxItemsPerRow || maxItemsPerRow) : maxItemsPerRow;
                        const rowContentActualWidth = itemsInCurrentRow * itemSize + (itemsInCurrentRow > 1 ? (itemsInCurrentRow - 1) * itemSpacing : 0);
                        const rowStartX = padding + (availableWidth - rowContentActualWidth) / 2;
                        const targetX = rowStartX + colIndex * (itemSize + itemSpacing);
                        const targetY = groupContentStartY + rowIndex * rowHeightWithSpacing;

                        void el.offsetWidth;
                        el.style.transition = `transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) ${index * 0.02}s, opacity 0.4s ease-out ${index * 0.02}s`;
                        el.style.transform = `translate(${targetX}px, ${targetY}px) scale(1)`;
                        el.style.opacity = '1';
                    });
                    yCursor += groupHeight;
                });
            };

            createElementDOMNodes();
            resetElementsLayout(true);

            const specificElementsObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        clearTimeout(animationTimeout); clearTimeout(mixTimeout);
                        animationTimeout = setTimeout(() => {
                            if (elementsContainer && elementsContainer.offsetWidth > 0 && elementsContainer.offsetHeight > 0) {
                                if (elementType === 'square' && containerId === 'dots-animation-container') {
                                    if (!areElementsOrganized && !isMixedState) {
                                        animateElementsMixedLayout();
                                        mixTimeout = setTimeout(() => {
                                            if (entry.isIntersecting) animateElementsOrganizedLayout();
                                            else isMixedState = false;
                                        }, 2500);
                                    }
                                } else {
                                    if (!areElementsOrganized) animateElementsOrganizedLayout();
                                }
                            }
                        }, 150);
                    } else {
                        clearTimeout(animationTimeout); clearTimeout(mixTimeout);
                        if (areElementsOrganized || isMixedState) resetElementsLayout();
                    }
                });
            }, { rootMargin: '0px 0px -5% 0px', threshold: 0.1 });

            if (elementsContainer) specificElementsObserver.observe(elementsContainer);

            let specificResizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(specificResizeTimeout);
                specificResizeTimeout = setTimeout(() => {
                    if (!elementsContainer) return;
                    const wasVisible = elementsContainer.classList.contains('is-visible');
                    createElementDOMNodes(); resetElementsLayout(true);
                    if (wasVisible) {
                        clearTimeout(animationTimeout); clearTimeout(mixTimeout);
                        areElementsOrganized = false; isMixedState = false;
                         animationTimeout = setTimeout(() => {
                            if (elementsContainer.offsetWidth > 0 && elementsContainer.offsetHeight > 0) {
                                if (elementType === 'square' && containerId === 'dots-animation-container') {
                                    animateElementsMixedLayout();
                                    mixTimeout = setTimeout(() => animateElementsOrganizedLayout(), 2500);
                                } else animateElementsOrganizedLayout();
                            }
                        }, 150);
                    }
                }, 250);
            });
        }

        setupAnimatedElements('intro-dots-visual', 50, ['var(--neon-yellow)', '#4ECDC4', '#FF6B6B'], "dot");
        setupAnimatedElements('dots-animation-container', 40, ['#7B68EE', '#1E90FF', '#FFD700', '#3CB371'], "square");
    };
</script>

</body>
</html>