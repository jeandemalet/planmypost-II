<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organisateur de Publications</title>
    <link rel="stylesheet" href="style.css">
    <!-- ‚ñº‚ñº‚ñº AJOUT DE NLP.JS POUR LA G√âN√âRATION DE HASHTAGS ‚ñº‚ñº‚ñº -->
    <script src="/lib/nlp.min.js"></script>
    <!-- ‚ñ≤‚ñ≤‚ñ≤ FIN DE L'AJOUT ‚ñ≤‚ñ≤‚ñ≤ -->
    <script src="/lib/smartcrop.js"></script>
    <script src="exif.js"></script>
</head>
<body>
    <div id="loadingOverlay" style="position: fixed; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(255,255,255,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center; text-align: center;">
        <p style="font-size: 1.5em; color: #333;">Initialisation de l'application...</p>
    </div>

    <div class="app-container">
        <header class="app-header">
            <div id="logoPlaceholder">
                <img src="/assets/logo.png" alt="Organisateur de Publications Logo" id="appLogo">
            </div>

            <div class="tabs">
                <button class="tab-button" data-tab="galleries"><img src="/assets/gallery.png" alt="Galeries" class="tab-icon"> Galeries</button>
                <button class="tab-button active" data-tab="currentGallery"><img src="/assets/tri.png" alt="Tri" class="tab-icon"> Tri</button>
                <button class="tab-button" data-tab="cropping"><img src="/assets/crop.png" alt="Recadrage" class="tab-icon"> Recadrage</button>
                <button class="tab-button" data-tab="description"><img src="/assets/description.png" alt="Description" class="tab-icon"> Description</button>
                <button class="tab-button" data-tab="calendar"><img src="/assets/calendar.png" alt="Calendrier" class="tab-icon"> Calendrier</button>
            </div>

            <nav id="userActionsPlaceholder">
                <div class="profile-container">
                    <button class="icon-button" id="profileButton" aria-label="Profil">
                        <img src="/assets/profile.png" alt="Profil" class="profile-action-icon">
                    </button>
                    <div id="profileDropdown" class="dropdown-menu">
                        <div id="userInfo">Connect√© en tant que...</div>
                        <a href="#" id="logoutLink">D√©connexion</a>
                    </div>
                </div>
                <button class="icon-button" aria-label="Param√®tres">
                    <img src="/assets/settings.png" alt="Param√®tres" class="profile-action-icon">
                </button>
            </nav>
        </header>

        <div id="galleries" class="tab-content">
            <div class="galleries-layout">
                <div id="galleriesListContainer">
                    <ul id="galleriesList"></ul>
                    <div class="gallery-management-controls">
                        <button id="createNewGalleryBtn" class="add-btn-green">
                            <img src="/assets/add-button.png" alt="" class="btn-icon"> Nouvelle Galerie
                        </button>
                        <!-- Formulaire de cr√©ation d√©plac√© dans la liste des galeries -->
                        <form id="newGalleryForm" style="display:none;">
                            <input type="text" id="newGalleryNameInput" placeholder="Nom de la nouvelle galerie">
                            <button type="submit" id="confirmNewGalleryBtn" class="small-confirm-btn">OK</button>
                            <button type="button" id="cancelNewGalleryBtn" class="small-cancel-btn">X</button>
                        </form>
                    </div>
                </div>
                <div id="galleryPreviewArea">
                    <div id="galleryPreviewHeader" style="display:none;">
                        <h3 id="galleryPreviewName"></h3>
                        <div id="galleryStatsArea" style="text-align: center; margin: 5px 0;">
                            <span id="galleryStatsLabelText">0 photo dans la galerie</span>
                        </div>
                        <div class="gallery-header-actions">
                            <button id="addPhotosToPreviewGalleryBtn" class="add-btn-green header-add-btn">
                                <img src="/assets/add-button.png" alt="" class="btn-icon"> <span class="btn-text">Ajouter des photos</span>
                            </button>
                        </div>
                    </div>
                    <div id="galleriesUploadProgressContainer" class="upload-progress-area" style="display:none; margin-bottom: 10px;">
                        <span id="galleriesUploadProgressText" class="upload-progress-text-label"></span>
                        <div class="upload-progress-bar-outer">
                            <div id="galleriesUploadProgressBarInner" class="upload-progress-bar-inner">0%</div>
                        </div>
                    </div>

                    <div id="galleryPreviewGrid"></div>
                     <p id="galleryPreviewPlaceholder">S√©lectionnez une galerie pour voir un aper√ßu ou la charger.</p>
                </div>
            </div>
        </div>

        <div id="currentGallery" class="tab-content">
            <div class="controls-bar">
                <span id="currentGalleryNameDisplay" style="margin-right: 10px; font-weight: bold;"></span>
                <button id="addNewImagesBtn" class="add-btn-green">
                    <img src="/assets/add-button.png" alt="" class="btn-icon"> Ajouter
                </button>
                <input type="file" id="imageSelector" multiple accept="image/*" style="display: none;">
                
                <div class="zoom-controls">
                    <button id="zoomOutBtn" class="zoom-btn-round">-</button>
                    <button id="zoomInBtn" class="zoom-btn-round">+</button>
                </div>
                <div class="sort-controls">
                    <select id="sortOptions">
                        <option value="" disabled>Trier par...</option>
                        <option value="name_asc" selected>Nom (A-Z)</option>
                        <option value="name_desc">Nom (Z-A)</option>
                        <option value="date_desc">Date Prise (Plus R√©cente)</option>
                        <option value="date_asc">Date Prise (Plus Ancienne)</option>
                    </select>
                </div>
                
                <div id="currentGalleryUploadProgressContainer" class="upload-progress-area" style="display:none; flex-grow:1; margin: 0 10px; max-width: 300px;">
                    <span id="currentGalleryUploadProgressText" class="upload-progress-text-label"></span>
                    <div class="upload-progress-bar-outer" style="height:12px;">
                        <div id="currentGalleryUploadProgressBarInner" class="upload-progress-bar-inner" style="height:100%; line-height:12px;">0%</div>
                    </div>
                </div>

                <div id="statsArea" style="margin-left:auto;">
                    <span id="statsLabelText">Grille: 0 | Publications: 0</span>
                </div>
            </div>

            <div class="main-editor-layout">
                <div id="imageGridContainer">
                    <button id="addPhotosPlaceholderBtn" class="add-photos-placeholder">
                        <img src="/assets/add-button.png" alt="" class="btn-icon"> <span class="btn-text">Ajouter des photos</span>
                    </button>
                    <div id="imageGrid"></div>
                </div>
                <div id="publicationFramesArea">
                    <!-- Le titre <h3>Publications</h3> a √©t√© supprim√© -->
                    <div id="publicationFramesContainer"></div>
                    <div class="publication-frames-actions">
                        <button id="addPublicationFrameBtn">
                             <img src="assets/add-button.png" alt="" class="btn-icon"> Ajouter Publication
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- =============================== -->
        <!--      ONGLET DE RECADRAGE        -->
        <!-- =============================== -->
        <div id="cropping" class="tab-content">
            <div class="cropping-layout">
                <!-- COLONNE DE GAUCHE : LISTE DES PUBLICATIONS -->
                <div id="croppingPublicationListPanel">
                    <h4>Publications de la Galerie</h4>
                    <button id="toggleCroppingViewBtn" class="secondary-action" style="width: 100%; margin-bottom: 10px;">
                        <img src="/assets/tri.png" alt="Tout voir" class="btn-icon"> 
                        <span id="toggleCroppingViewBtnText">Tout voir</span>
                    </button>
                    <ul id="croppingPublicationList">
                    </ul>
                </div>

                <!-- COLONNE CENTRALE : CONTENU PRINCIPAL (VUE D'ENSEMBLE OU √âDITEUR) -->
                <div id="croppingEditorContainer">
                    <h3 id="croppingEditorTitle">S√©lectionnez une publication √† recadrer</h3>
                    
                    <div id="allPhotosGroupedViewContainer" style="display: none;">
                        <!-- Le contenu de la vue d'ensemble sera inject√© ici par JS -->
                    </div>

                    <div id="croppingEditorPanel" style="display: none;">
                        <div class="cropper-main-area">
                            <div class="cropper-canvas-container">
                                <canvas id="cropperCanvas"></canvas>
                            </div>
                            <div class="cropper-right-panel">
                                <div class="cropper-previews">
                                    <div class="preview-title">Aper√ßu</div>
                                    <img id="cropperPreviewLeft" alt="Aper√ßu Gauche">
                                    <img id="cropperPreviewCenter" alt="Aper√ßu Milieu">
                                    <img id="cropperPreviewRight" alt="Aper√ßu Droit">
                                </div>
                                <!-- LE BLOC DE RECADRAGE AUTO A √âT√â D√âPLAC√â D'ICI... -->
                            </div>
                        </div>
                        <div class="cropper-controls">
                            <button id="cropPrevImageBtn" title="Image pr√©c√©dente"><img src="assets/previous.png" alt="Pr√©c√©dent"></button>
                            <button id="cropNextImageBtn" title="Image suivante"><img src="assets/next.png" alt="Suivant"></button>
                            <button id="cropFlipBtn" title="Retourner Horizontalement"><img src="assets/turn-around.png" alt="Retourner"></button>
                            <select id="cropAspectRatio">
                                <option value="3:4">3:4 (Vertical)</option>
                                <option value="1:1">1:1 (Carr√©)</option>
                                <option value="16:9">16:9 (Paysage)</option>
                                <option value="3:2">3:2 (Paysage)</option>
                                <option value="free">Libre</option>
                            </select>
                            <button id="cropAddWhiteBarsBtn" title="Ajouter des barres blanches (format 3:4)"><img src="assets/barres-blanches.png" alt="Barres Blanches"></button>
                            <button id="cropSplitLineBtn" title="Diviser l'image pour un carrousel"><img src="assets/split.png" alt="Split"></button>
                            <button id="cropDeleteBtn" title="Supprimer et passer √† la suivante"><img src="assets/bin.png" alt="Supprimer"></button>
                            <button id="cropFinishBtn" class="primary-action" title="Terminer et appliquer les recadrages"><img src="assets/confirm.png" alt="Terminer et Appliquer"></button>
                            <div id="cropperInfoLabel"></div>
                        </div>
                        <div id="croppingThumbnailStrip" class="cropping-thumbnail-strip"></div>
                    </div>
                    <p id="croppingEditorPlaceholder">Aucune publication s√©lectionn√©e.</p>
                </div>

                <!-- COLONNE DE DROITE : BARRE LAT√âRALE POUR LE RECADRAGE AUTO -->
                <div id="autoCropSidebar" class="cropping-sidebar-right">
                    <!-- ...VERS ICI. -->
                    <div class="auto-crop-frame">
                        <fieldset>
                            <legend>Recadrage automatique</legend>
                            
                            <div class="auto-crop-setting">
                                <span class="setting-label">Photos verticales</span>
                                <div class="setting-options">
                                    <input type="radio" id="v-auto" name="vertical_treatment" value="auto">
                                    <label for="v-auto" class="auto-crop-button">
                                        <img src="assets/AI.png" alt="Ic√¥ne Recadrage IA" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Recadrage auto</span>
                                    </label>
                                    
                                    <input type="radio" id="v-bars" name="vertical_treatment" value="whitebars">
                                    <label for="v-bars" class="auto-crop-button">
                                        <img src="assets/barres-blanches.png" alt="Ic√¥ne Barres Blanches" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Barres blanches</span>
                                    </label>
                                    
                                    <input type="radio" id="v-none" name="vertical_treatment" value="none" checked>
                                    <label for="v-none" class="auto-crop-button">
                                        <img src="assets/nerienfaire.png" alt="Ic√¥ne Ne rien faire" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Ne rien faire</span>
                                    </label>
                                </div>
                            </div>
            
                            <div class="auto-crop-setting">
                                 <span class="setting-label">Photos horizontales</span>
                                 <div class="setting-options">
                                    <input type="radio" id="h-bars" name="horizontal_treatment" value="whitebars" checked>
                                    <label for="h-bars" class="auto-crop-button">
                                        <img src="assets/barres-blanches.png" alt="Ic√¥ne Barres Blanches" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Barres blanches</span>
                                    </label>
                                    
                                    <input type="radio" id="h-none" name="horizontal_treatment" value="none">
                                    <label for="h-none" class="auto-crop-button">
                                        <img src="assets/nerienfaire.png" alt="Ic√¥ne Ne rien faire" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Ne rien faire</span>
                                    </label>
                                 </div>
                            </div>
                            <div class="auto-crop-scope-switch">
                                <input type="radio" id="cropScopeAll" name="crop_scope" value="all" checked>
                                <label for="cropScopeAll">Tout recadrer</label>
                                
                                <input type="radio" id="cropScopeDay" name="crop_scope" value="selection">
                                <label for="cropScopeDay">S√©lection</label>
                            </div>
                            
                            <div id="publicationSelectionContainer" class="publication-selection-container" style="display: none;">
                                <div class="publication-selection-header">
                                    <span class="selection-title">S√©lectionner les publications :</span>
                                    <div class="selection-actions">
                                        <button type="button" id="selectAllPublicationsBtn" class="selection-btn">Tout</button>
                                        <button type="button" id="deselectAllPublicationsBtn" class="selection-btn">Aucun</button>
                                    </div>
                                </div>
                                <div id="publicationCheckboxList" class="publication-checkbox-list">
                                    <!-- Les checkboxes seront g√©n√©r√©es dynamiquement ici -->
                                </div>
                            </div>
                            <div class="auto-crop-actions">
                                <button id="runAutoCropBtn" class="primary-action" title="Lancer le recadrage automatique">
                                    Lancer l'automatisation
                                </button>
                            </div>
                            <div id="autoCropProgress" class="auto-crop-progress" style="display: none;"></div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div id="description" class="tab-content">
            <!-- ‚ñº‚ñº‚ñº REMPLACEZ TOUT LE BLOC <div class="description-layout"> PAR CELUI-CI ‚ñº‚ñº‚ñº -->
            <div class="description-layout">
                <div id="descriptionPublicationListPanel">
                    <ul id="descriptionMainList"></ul>
                    <h4 class="publication-list-separator">Publications Sp√©cifiques</h4>
                    <ul id="descriptionPublicationList"></ul>
                </div>
                
                <!-- Nouveau conteneur pour l'√©diteur et la colonne de raccourcis -->
                <div class="description-editor-area">
                    <div id="descriptionEditorPanel">
                        <h3 id="descriptionEditorTitle">S√©lectionnez une publication pour √©diter sa description</h3>
                        <div id="descriptionEditorContent" style="display: none;">
                            <div id="descriptionImagesPreview" class="images-preview-banner"></div>
                            <div class="description-fields">
                                <label for="descriptionEditor">Texte de la publication:</label>
                                <div id="descriptionEditor" contenteditable="true" class="custom-editor"
                                     role="textbox" aria-multiline="true" data-placeholder="√âcrivez votre description ici..."></div>
                            </div>
                        </div>
                        <p id="descriptionEditorPlaceholder">Aucune publication s√©lectionn√©e.</p>
                    </div>
                    
                    <!-- Le bloc de raccourcis est maintenant ici, √† c√¥t√© de l'√©diteur -->
                    <div id="descriptionShortcuts" class="description-shortcuts">
                        <div class="shortcut-item">
                            <button data-snippet="üì∏ Photographe : ">üì∏ Photographe</button>
                        </div>
                        <div class="shortcut-item is-pair">
                            <button data-snippet="üßµ Couturier : ">üßµ Couturier</button>
                            <button data-snippet="üßµ Couturi√®re : ">üßµ Couturi√®re</button>
                        </div>
                        <div class="shortcut-item is-pair">
                            <button data-snippet="‚ú® Assistant : ">‚ú® Assistant</button>
                            <button data-snippet="‚ú® Assistante : ">‚ú® Assistante</button>
                        </div>
                        
                        <div class="shortcut-item is-pair">
                            <button data-snippet="üíÑ Maquilleur : ">üíÑ Maquilleur</button>
                            <button data-snippet="üíÑ Maquilleuse : ">üíÑ Maquilleuse</button>
                        </div>
                        
                        <div class="shortcut-item is-pair">
                            <button data-snippet="‚úÇÔ∏è Coiffeur : ">‚úÇÔ∏è Coiffeur</button>
                            <button data-snippet="‚úÇÔ∏è Coiffeuse : ">‚úÇÔ∏è Coiffeuse</button>
                        </div>
                        <div class="shortcut-item">
                            <button data-snippet="üíÉ Sujet(s) : ">üíÉ Sujet(s)</button>
                        </div>
                        
                        <div class="shortcut-item">
                            <button data-snippet="üìç Lieu : ">üìç Lieu</button>
                        </div>
                        <div class="shortcut-item-separator"></div>
                        <div class="shortcut-item">
                           <button id="generateHashtagsBtn" class="action-button">ü§ñ G√©n√©rer les Hashtags</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ‚ñ≤‚ñ≤‚ñ≤ FIN DU REMPLACEMENT ‚ñ≤‚ñ≤‚ñ≤ -->
        </div>

        <div id="calendar" class="tab-content">
            <div class="calendar-layout">
                <div id="calendarPublicationListPanel">
                    <ul id="calendarPublicationList">
                    </ul>
                </div>
                <div id="calendar-main-content">
                    <div class="scheduler-header">
                        <div id="monthSelectorContainer">
                            <ul id="monthSelector">
                                <!-- Les mois seront g√©n√©r√©s ici par JavaScript -->
                            </ul>
                            <span id="yearLabel">2025</span>
                        </div>
                        <button id="todayBtn">Aujourd'hui</button>
                    </div>
                    <div id="calendarGrid"></div>
                </div>
                <div id="calendar-sidebar">
                    <div class="sidebar-section auto-schedule-box">
                        <h4>Planification Automatique</h4>
                        <div class="auto-schedule-options">
                            <div class="option-group">
                                <input type="radio" id="autoScheduleChrono" name="autoScheduleMode" value="chrono" checked>
                                <label for="autoScheduleChrono" title="Place les publications les unes apr√®s les autres, dans l'ordre (Publication A, Publication B, Publication C...)."><img src="/assets/chronologique.png" alt="Icone chronologique" class="schedule-icon"/> Chronologique</label>
                            </div>
                            <div class="option-group">
                                <input type="radio" id="autoScheduleInterlaced" name="autoScheduleMode" value="interlaced">
                                <label for="autoScheduleInterlaced" title="Place les publications en alternant les galeries, tout en respectant l'ordre chronologique de chaque galerie."><img src="/assets/al√©atoire interlac√©.png" alt="Icone al√©atoire interlac√©" class="schedule-icon"/> Chronologique Interlac√©</label>
                            </div>
                            <div class="option-group">
                                <input type="radio" id="autoScheduleRandom" name="autoScheduleMode" value="random">
                                <label for="autoScheduleRandom" title="Place les publications de mani√®re al√©atoire sur les dates disponibles."><img src="/assets/al√©atoire (2).png" alt="Icone al√©atoire" class="schedule-icon"/> Al√©atoire</label>
                            </div>
                        </div>
                        <div class="auto-schedule-settings">
                            <div class="setting-group">
                                <label for="autoSchedulePerDay">Publier</label>
                                <input type="number" id="autoSchedulePerDay" value="1" min="1">
                                <span>tous les</span>
                                <input type="number" id="autoScheduleEveryXDays" value="1" min="1">
                                <span>jour(s)</span>
                            </div>
                        </div>
                        <button id="runAutoScheduleBtn" class="primary-action icon-only" title="Lancer la Planification"><img src="/assets/play.png" alt="Lancer la Planification" class="btn-icon"></button>
                        <p id="auto-schedule-info" class="sidebar-info"></p>
                    </div>
                    <div id="unscheduledPublicationsContainer" class="sidebar-section">
                        <h4>Publications √† Planifier</h4>
                        <div id="unscheduledPublicationsList">
                        </div>
                        <button id="reorganizeAllBtn" class="secondary-action" style="margin-top: 10px;">Tout R√©organiser</button>
                        <button id="downloadAllScheduledBtn" class="primary-action" style="margin-top: 5px;">Tout T√©l√©charger</button>
                    </div>
                </div>
            </div>
            <div id="calendarContextPreviewModal" class="modal-preview">
                <h4 id="calendarContextTitle">Aper√ßu</h4>
                <div id="calendarContextImages"></div>
            </div>
        </div>
    </div>
    <script src="script.js"></script>

    <!-- ‚ñº‚ñº‚ñº AJOUT DE LA MODALE POUR L'ASSISTANT HASHTAGS ‚ñº‚ñº‚ñº -->
    <div id="hashtagModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h4>Suggestions de Hashtags</h4>
            <p>Cliquez sur les hashtags que vous souhaitez retirer, puis validez.</p>
            <div id="hashtagContainer" class="hashtag-container">
                <!-- Les hashtags g√©n√©r√©s appara√Ætront ici -->
            </div>
            <div class="modal-actions">
                <button id="cancelHashtagsBtn" class="secondary-action">Annuler</button>
                <button id="insertHashtagsBtn" class="primary-action">Ins√©rer la s√©lection</button>
            </div>
        </div>
    </div>
    <!-- ‚ñ≤‚ñ≤‚ñ≤ FIN DE L'AJOUT ‚ñ≤‚ñ≤‚ñ≤ -->
</body>
</html>