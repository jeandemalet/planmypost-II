<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organisateur de Publications</title>
    <link rel="stylesheet" href="style.css">
    <script src="/lib/smartcrop.js"></script>
    <script src="exif.js"></script>
</head>
<body>
    <div id="loadingOverlay" style="position: fixed; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(255,255,255,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center; text-align: center;">
        <p style="font-size: 1.5em; color: #333;">Initialisation de l'application...</p>
    </div>

    <div class="app-container">
        <header class="app-header">
            <div id="logoPlaceholder">
                <img src="/assets/logo.png" alt="Organisateur de Publications Logo" id="appLogo">
            </div>

            <div class="tabs">
                <button class="tab-button" data-tab="galleries"><img src="/assets/gallery.png" alt="Galeries" class="tab-icon"> Galeries</button>
                <button class="tab-button active" data-tab="currentGallery"><img src="/assets/tri.png" alt="Tri" class="tab-icon"> Tri</button>
                <button class="tab-button" data-tab="cropping"><img src="/assets/crop.png" alt="Recadrage" class="tab-icon"> Recadrage</button>
                <button class="tab-button" data-tab="description"><img src="/assets/description.png" alt="Description" class="tab-icon"> Description</button>
                <button class="tab-button" data-tab="calendar"><img src="/assets/calendar.png" alt="Calendrier" class="tab-icon"> Calendrier</button>
            </div>

            <nav id="userActionsPlaceholder">
                <div class="profile-container">
                    <button class="icon-button" id="profileButton" aria-label="Profil">
                        <img src="/assets/profile.png" alt="Profil" class="profile-action-icon">
                    </button>
                    <div id="profileDropdown" class="dropdown-menu">
                        <div id="userInfo">Connecté en tant que...</div>
                        <a href="#" id="logoutLink">Déconnexion</a>
                    </div>
                </div>
                <button class="icon-button" aria-label="Paramètres">
                    <img src="/assets/settings.png" alt="Paramètres" class="profile-action-icon">
                </button>
            </nav>
        </header>

        <div id="galleries" class="tab-content">
            <div class="galleries-layout">
                <div id="galleriesListContainer">
                    <ul id="galleriesList"></ul>
                    <div class="gallery-management-controls">
                        <button id="createNewGalleryBtn" class="add-btn-green">
                            <img src="/assets/add-button.png" alt="" class="btn-icon"> Nouvelle Galerie
                        </button>
                        <!-- Formulaire de création déplacé dans la liste des galeries -->
                        <form id="newGalleryForm" style="display:none;">
                            <input type="text" id="newGalleryNameInput" placeholder="Nom de la nouvelle galerie">
                            <button type="submit" id="confirmNewGalleryBtn" class="small-confirm-btn">OK</button>
                            <button type="button" id="cancelNewGalleryBtn" class="small-cancel-btn">X</button>
                        </form>
                    </div>
                </div>
                <div id="galleryPreviewArea">
                    <div id="galleryPreviewHeader" style="display:none;">
                        <h3 id="galleryPreviewName"></h3>
                        <div style="display: flex !important; gap: 10px; margin-left: auto !important;">
                            <button id="addPhotosToPreviewGalleryBtn" class="add-btn-green">
                                <img src="/assets/add-button.png" alt="" class="btn-icon"> <span class="btn-text">Ajouter des photos</span>
                            </button>
                        </div>
                    </div>
                    <div id="galleriesUploadProgressContainer" class="upload-progress-area" style="display:none; margin-bottom: 10px;">
                        <span id="galleriesUploadProgressText" class="upload-progress-text-label"></span>
                        <div class="upload-progress-bar-outer">
                            <div id="galleriesUploadProgressBarInner" class="upload-progress-bar-inner">0%</div>
                        </div>
                    </div>
                    <div id="galleryPreviewGrid"></div>
                     <p id="galleryPreviewPlaceholder">Sélectionnez une galerie pour voir un aperçu ou la charger.</p>
                </div>
            </div>
        </div>

        <div id="currentGallery" class="tab-content">
            <div class="controls-bar">
                <span id="currentGalleryNameDisplay" style="margin-right: 10px; font-weight: bold;"></span>
                <button id="switchToGalleriesBtn" class="secondary-action">
                    <img src="/assets/gallery.png" alt="" class="btn-icon"> Changer de galerie
                </button>
                <button id="addNewImagesBtn" class="add-btn-green">
                    <img src="/assets/add-button.png" alt="" class="btn-icon"> Ajouter
                </button>
                <input type="file" id="imageSelector" multiple accept="image/*" style="display: none;">
                
                <div class="zoom-controls">
                    <button id="zoomOutBtn" class="zoom-btn-round">-</button>
                    <button id="zoomInBtn" class="zoom-btn-round">+</button>
                </div>
                <div class="sort-controls">
                    <label for="sortOptions">Trier par:</label>
                    <select id="sortOptions">
                        <option value="name_asc">Nom (A-Z)</option>
                        <option value="name_desc">Nom (Z-A)</option>
                        <option value="date_desc">Date Prise (Plus Récente)</option>
                        <option value="date_asc">Date Prise (Plus Ancienne)</option>
                    </select>
                </div>
                
                <div id="currentGalleryUploadProgressContainer" class="upload-progress-area" style="display:none; flex-grow:1; margin: 0 10px; max-width: 300px;">
                    <span id="currentGalleryUploadProgressText" class="upload-progress-text-label"></span>
                    <div class="upload-progress-bar-outer" style="height:12px;">
                        <div id="currentGalleryUploadProgressBarInner" class="upload-progress-bar-inner" style="height:100%; line-height:12px;">0%</div>
                    </div>
                </div>

                <div id="statsArea" style="margin-left:auto;">
                    <span id="statsLabelText">Grille: 0 | Jours: 0</span>
                </div>
            </div>

            <div class="main-editor-layout">
                <div id="imageGridContainer">
                    <button id="addPhotosPlaceholderBtn" class="add-photos-placeholder">
                        <img src="/assets/add-button.png" alt="" class="btn-icon"> <span class="btn-text">Ajouter des photos</span>
                    </button>
                    <div id="imageGrid"></div>
                </div>
                <div id="jourFramesArea">
                    <h3>Jours de Publication</h3>
                    <div id="jourFramesContainer"></div>
                    <div class="jour-frames-actions">
                        <button id="addJourFrameBtn">
                             <img src="assets/add-button.png" alt="" class="btn-icon"> Ajouter Jour
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- =============================== -->
        <!--      ONGLET DE RECADRAGE        -->
        <!-- =============================== -->
        <div id="cropping" class="tab-content">
            <div class="cropping-layout">
                <!-- COLONNE DE GAUCHE : LISTE DES JOURS -->
                <div id="croppingJourListPanel">
                    <h4>Jours de la Galerie</h4>
                    <button id="toggleCroppingViewBtn" class="secondary-action" style="width: 100%; margin-bottom: 10px;">
                        <img src="/assets/tri.png" alt="Tout voir" class="btn-icon"> 
                        <span id="toggleCroppingViewBtnText">Tout voir</span>
                    </button>
                    <ul id="croppingJourList">
                    </ul>
                </div>

                <!-- COLONNE CENTRALE : CONTENU PRINCIPAL (VUE D'ENSEMBLE OU ÉDITEUR) -->
                <div id="croppingEditorContainer">
                    <h3 id="croppingEditorTitle">Sélectionnez un jour à recadrer</h3>
                    
                    <div id="allPhotosGroupedViewContainer" style="display: none;">
                        <!-- Le contenu de la vue d'ensemble sera injecté ici par JS -->
                    </div>

                    <div id="croppingEditorPanel" style="display: none;">
                        <div class="cropper-main-area">
                            <div class="cropper-canvas-container">
                                <canvas id="cropperCanvas"></canvas>
                            </div>
                            <div class="cropper-right-panel">
                                <div class="cropper-previews">
                                    <div class="preview-title">Aperçu</div>
                                    <img id="cropperPreviewLeft" alt="Aperçu Gauche">
                                    <img id="cropperPreviewCenter" alt="Aperçu Milieu">
                                    <img id="cropperPreviewRight" alt="Aperçu Droit">
                                </div>
                                <!-- LE BLOC DE RECADRAGE AUTO A ÉTÉ DÉPLACÉ D'ICI... -->
                            </div>
                        </div>
                        <div class="cropper-controls">
                            <button id="cropPrevImageBtn" title="Image précédente"><img src="assets/previous.png" alt="Précédent"></button>
                            <button id="cropNextImageBtn" title="Image suivante"><img src="assets/next.png" alt="Suivant"></button>
                            <button id="cropFlipBtn" title="Retourner Horizontalement"><img src="assets/turn-around.png" alt="Retourner"></button>
                            <select id="cropAspectRatio">
                                <option value="3:4">3:4 (Vertical)</option>
                                <option value="1:1">1:1 (Carré)</option>
                                <option value="16:9">16:9 (Paysage)</option>
                                <option value="3:2">3:2 (Paysage)</option>
                                <option value="free">Libre</option>
                            </select>
                            <button id="cropAddWhiteBarsBtn" title="Ajouter des barres blanches (format 3:4)"><img src="assets/barres-blanches.png" alt="Barres Blanches"></button>
                            <button id="cropSplitLineBtn" title="Diviser l'image pour un carrousel"><img src="assets/split.png" alt="Split"></button>
                            <button id="cropDeleteBtn" title="Supprimer et passer à la suivante"><img src="assets/bin.png" alt="Supprimer"></button>
                            <button id="cropFinishBtn" class="primary-action" title="Terminer et appliquer les recadrages"><img src="assets/confirm.png" alt="Terminer et Appliquer"></button>
                            <div id="cropperInfoLabel"></div>
                        </div>
                        <div id="croppingThumbnailStrip" class="cropping-thumbnail-strip"></div>
                    </div>
                    <p id="croppingEditorPlaceholder">Aucun jour sélectionné.</p>
                </div>

                <!-- COLONNE DE DROITE : BARRE LATÉRALE POUR LE RECADRAGE AUTO -->
                <div id="autoCropSidebar" class="cropping-sidebar-right">
                    <!-- ...VERS ICI. -->
                    <div class="auto-crop-frame">
                        <fieldset>
                            <legend>Recadrage automatique</legend>
                            
                            <div class="auto-crop-setting">
                                <span class="setting-label">Photos verticales</span>
                                <div class="setting-options">
                                    <input type="radio" id="v-auto" name="vertical_treatment" value="auto">
                                    <label for="v-auto" class="auto-crop-button">
                                        <img src="assets/AI.png" alt="Icône Recadrage IA" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Recadrage auto</span>
                                    </label>
                                    
                                    <input type="radio" id="v-bars" name="vertical_treatment" value="whitebars">
                                    <label for="v-bars" class="auto-crop-button">
                                        <img src="assets/barres-blanches.png" alt="Icône Barres Blanches" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Barres blanches</span>
                                    </label>
                                    
                                    <input type="radio" id="v-none" name="vertical_treatment" value="none" checked>
                                    <label for="v-none" class="auto-crop-button">
                                        <img src="assets/nerienfaire.png" alt="Icône Ne rien faire" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Ne rien faire</span>
                                    </label>
                                </div>
                            </div>
            
                            <div class="auto-crop-setting">
                                 <span class="setting-label">Photos horizontales</span>
                                 <div class="setting-options">
                                    <input type="radio" id="h-bars" name="horizontal_treatment" value="whitebars" checked>
                                    <label for="h-bars" class="auto-crop-button">
                                        <img src="assets/barres-blanches.png" alt="Icône Barres Blanches" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Barres blanches</span>
                                    </label>
                                    
                                    <input type="radio" id="h-none" name="horizontal_treatment" value="none">
                                    <label for="h-none" class="auto-crop-button">
                                        <img src="assets/nerienfaire.png" alt="Icône Ne rien faire" class="auto-crop-icon">
                                        <span class="auto-crop-label-text">Ne rien faire</span>
                                    </label>
                                 </div>
                            </div>
                            <div class="auto-crop-scope-switch">
                                <input type="radio" id="cropScopeAll" name="crop_scope" value="all" checked>
                                <label for="cropScopeAll">Tout recadrer</label>
                                
                                <input type="radio" id="cropScopeDay" name="crop_scope" value="selection">
                                <label for="cropScopeDay">Sélection</label>
                            </div>
                            
                            <div id="jourSelectionContainer" class="jour-selection-container" style="display: none;">
                                <div class="jour-selection-header">
                                    <span class="selection-title">Sélectionner les jours :</span>
                                    <div class="selection-actions">
                                        <button type="button" id="selectAllJoursBtn" class="selection-btn">Tout</button>
                                        <button type="button" id="deselectAllJoursBtn" class="selection-btn">Aucun</button>
                                    </div>
                                </div>
                                <div id="jourCheckboxList" class="jour-checkbox-list">
                                    <!-- Les checkboxes seront générées dynamiquement ici -->
                                </div>
                            </div>
                            <div class="auto-crop-actions">
                                <button id="runAutoCropBtn" class="primary-action" title="Lancer le recadrage automatique">
                                    Lancer l'automatisation
                                </button>
                            </div>
                            <div id="autoCropProgress" class="auto-crop-progress" style="display: none;"></div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>

        <div id="description" class="tab-content">
            <div class="description-layout">
                <div id="descriptionJourListPanel">
                    <ul id="descriptionJourList">
                    </ul>
                </div>
                <div id="descriptionEditorPanel">
                    <h3 id="descriptionEditorTitle">Sélectionnez un jour pour éditer sa description</h3>
                    <div id="descriptionEditorContent" style="display: none;">
                        <div id="descriptionImagesPreview" class="images-preview-banner"></div>
                        <div class="description-fields">
                            <label for="descriptionText">Texte de la publication:</label>
                            <textarea id="descriptionText" rows="10" placeholder="Écrivez votre description ici..."></textarea>
                            <label for="descriptionHashtags">Hashtags (séparés par des espaces ou des virgules):</label>
                            <textarea id="descriptionHashtags" rows="3" placeholder="#exemple #hashtag ..."></textarea>
                        </div>
                    </div>
                    <p id="descriptionEditorPlaceholder">Aucun jour sélectionné.</p>
                </div>
            </div>
        </div>

        <div id="calendar" class="tab-content">
            <div class="calendar-layout">
                <div id="calendarJourListPanel">
                    <ul id="calendarJourList">
                    </ul>
                </div>
                <div id="calendar-main-content">
                    <div class="scheduler-header">
                        <h2 id="monthYearLabel">Mois Année</h2>
                        <button id="todayBtn">Aujourd'hui</button>
                    </div>
                    <div id="calendarGrid"></div>
                </div>
                <div id="calendar-sidebar">
                    <div class="sidebar-section auto-schedule-box">
                        <h4>Planification Automatique</h4>
                        <div class="auto-schedule-options">
                            <div class="option-group">
                                <input type="radio" id="autoScheduleChrono" name="autoScheduleMode" value="chrono" checked>
                                <label for="autoScheduleChrono" title="Place les jours les uns après les autres, dans l'ordre (Jour A, Jour B, Jour C...)."><img src="/assets/chronologique.png" alt="Icone chronologique" class="schedule-icon"/> Chronologique</label>
                            </div>
                            <div class="option-group">
                                <input type="radio" id="autoScheduleInterlaced" name="autoScheduleMode" value="interlaced">
                                <label for="autoScheduleInterlaced" title="Place les jours en alternant les galeries, tout en respectant l'ordre chronologique de chaque galerie."><img src="/assets/aléatoire interlacé.png" alt="Icone aléatoire interlacé" class="schedule-icon"/> Chronologique Interlacé</label>
                            </div>
                            <div class="option-group">
                                <input type="radio" id="autoScheduleRandom" name="autoScheduleMode" value="random">
                                <label for="autoScheduleRandom" title="Place les jours de manière aléatoire sur les dates disponibles."><img src="/assets/aléatoire (2).png" alt="Icone aléatoire" class="schedule-icon"/> Aléatoire</label>
                            </div>
                        </div>
                        <div class="auto-schedule-settings">
                            <div class="setting-group">
                                <label for="autoSchedulePerDay">Publier</label>
                                <input type="number" id="autoSchedulePerDay" value="1" min="1">
                                <span>tous les</span>
                                <input type="number" id="autoScheduleEveryXDays" value="1" min="1">
                                <span>jour(s)</span>
                            </div>
                        </div>
                        <button id="runAutoScheduleBtn" class="primary-action icon-only" title="Lancer la Planification"><img src="/assets/play.png" alt="Lancer la Planification" class="btn-icon"></button>
                        <p id="auto-schedule-info" class="sidebar-info"></p>
                    </div>
                    <div id="unscheduledJoursContainer" class="sidebar-section">
                        <h4>Jours à Planifier</h4>
                        <div id="unscheduledJoursList">
                        </div>
                        <button id="reorganizeAllBtn" class="secondary-action" style="margin-top: 10px;">Tout Réorganiser</button>
                        <button id="downloadAllScheduledBtn" class="primary-action" style="margin-top: 5px;">Tout Télécharger</button>
                    </div>
                </div>
            </div>
            <div id="calendarContextPreviewModal" class="modal-preview">
                <h4 id="calendarContextTitle">Aperçu</h4>
                <div id="calendarContextImages"></div>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>