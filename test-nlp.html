<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test NLP.js</title>
    <script src="public/lib/nlp.min.js"></script>pjs/nlp@4.23.5/dist/nlp.min.js"></script>
</head>

<body>
    <h1>Test de NLP.js pour la génération de hashtags</h1>
    <textarea id="textInput" rows="5" cols="50" placeholder="Entrez votre texte ici...">
Séance photo avec une magnifique robe rouge dans un jardin fleuri. Le modèle porte une création élégante avec des détails brodés. L'ambiance romantique et la lumière dorée créent une atmosphère magique.
    </textarea>
    <br><br>
    <button onclick="generateHashtags()">Générer les hashtags</button>
    <br><br>
    <div id="result"></div>

    <script>
        let nlpManager = null;

        async function generateHashtags() {
            const text = document.getElementById('textInput').value;
            const resultDiv = document.getElementById('result');

            resultDiv.innerHTML = 'Analyse en cours...';

            try {
                // Initialisation du manager NLP
                if (!nlpManager) {
                    const { NlpManager } = window.nlpjs;
                    nlpManager = new NlpManager({ languages: ['fr'], forceNER: true });
                }

                if (!text || text.trim().length < 5) {
                    resultDiv.innerHTML = 'Texte trop court';
                    return;
                }

                const response = await nlpManager.process('fr', text);

                // Les POS tags pour les noms et adjectifs en français avec NLP.js
                const importantTags = ['NOUN', 'PROPN', 'ADJ'];

                const keywords = new Set();

                response.classifications.forEach(classification => {
                    if (importantTags.includes(classification.pos)) {
                        // Nettoyage : minuscule, sans accents, et assez long
                        const keyword = classification.token
                            .toLowerCase()
                            .normalize("NFD").replace(/[\u0300-\u036f]/g, "");

                        if (keyword.length > 2) {
                            keywords.add(keyword);
                        }
                    }
                });

                if (keywords.size === 0) {
                    resultDiv.innerHTML = 'Aucun mot-clé trouvé';
                    return;
                }

                // Ajout de hashtags de base
                keywords.add('photographe');
                keywords.add('photography');

                const hashtags = Array.from(keywords).map(k => `#${k}`).join(' ');
                resultDiv.innerHTML = `<strong>Hashtags générés:</strong><br>${hashtags}`;

                // Debug info
                console.log('Response:', response);
                console.log('Keywords found:', Array.from(keywords));

            } catch (error) {
                console.error("Erreur:", error);
                resultDiv.innerHTML = `Erreur: ${error.message}`;
            }
        }
    </script>
</body>

</html>