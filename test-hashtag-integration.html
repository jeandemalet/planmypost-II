<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Intégration Hashtags</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-area { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Test d'Intégration - Générateur de Hashtags</h1>
    
    <div class="test-area">
        <h3>Test 1: Vérification de la bibliothèque NLP</h3>
        <button onclick="testNLP()">Tester NLP.js</button>
        <div id="nlpResult" class="result"></div>
    </div>

    <div class="test-area">
        <h3>Test 2: Chargement du dictionnaire</h3>
        <button onclick="testDictionary()">Tester le Dictionnaire</button>
        <div id="dictResult" class="result"></div>
    </div>

    <div class="test-area">
        <h3>Test 3: Génération de hashtags</h3>
        <textarea id="testText" placeholder="Entrez votre texte de test ici...">Séance photo de mariage à Paris avec une magnifique robe de mariée. La maquilleuse a fait un travail exceptionnel pour ce portrait en noir et blanc.</textarea>
        <button onclick="testHashtagGeneration()">Générer les Hashtags</button>
        <div id="hashtagResult" class="result"></div>
    </div>

    <script src="/lib/nlp.min.js"></script>
    <script>
        async function testNLP() {
            const resultDiv = document.getElementById('nlpResult');
            try {
                if (typeof window.nlp !== 'undefined') {
                    const testText = "Bonjour photographe portrait mode";
                    const hashtags = window.nlp.generateHashtags(testText);
                    resultDiv.innerHTML = `✅ NLP.js chargé avec succès!<br>Test: "${testText}"<br>Hashtags générés: ${hashtags.join(', ')}`;
                } else {
                    resultDiv.innerHTML = '❌ NLP.js non disponible';
                }
            } catch (error) {
                resultDiv.innerHTML = `❌ Erreur: ${error.message}`;
            }
        }

        async function testDictionary() {
            const resultDiv = document.getElementById('dictResult');
            try {
                const response = await fetch('/lib/hashtag-thesaurus.json');
                if (response.ok) {
                    const thesaurus = await response.json();
                    const keys = Object.keys(thesaurus);
                    resultDiv.innerHTML = `✅ Dictionnaire chargé avec succès!<br>Mots-clés disponibles: ${keys.join(', ')}`;
                } else {
                    resultDiv.innerHTML = `❌ Erreur de chargement: ${response.status}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `❌ Erreur: ${error.message}`;
            }
        }

        async function testHashtagGeneration() {
            const resultDiv = document.getElementById('hashtagResult');
            const text = document.getElementById('testText').value;
            
            try {
                // Simuler la logique du HashtagManager
                const response = await fetch('/lib/hashtag-thesaurus.json');
                const thesaurus = await response.json();
                
                const keywordsFromNLP = window.nlp ? window.nlp.generateHashtags(text) : [];
                const suggestedHashtags = new Map();
                const normalizedText = text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

                // Enrichir avec le thésaurus
                for (const [key, value] of Object.entries(thesaurus)) {
                    if (normalizedText.includes(key)) {
                        value.h.forEach(tag => suggestedHashtags.set(tag, value.p));
                    }
                }

                // Ajouter les mots-clés NLP
                keywordsFromNLP.forEach(keyword => {
                    const lowerKeyword = keyword.toLowerCase();
                    if (!suggestedHashtags.has(lowerKeyword)) {
                        suggestedHashtags.set(lowerKeyword, 10);
                    }
                });

                // Ajouter des hashtags de base
                suggestedHashtags.set('photographe', 5);
                suggestedHashtags.set('photography', 5);

                // Trier par priorité
                const sorted = [...suggestedHashtags.entries()].sort((a, b) => b[1] - a[1]);
                const existingHashtags = (text.match(/#[\w\u00C0-\u017F]+/g) || []).map(h => h.substring(1).toLowerCase());
                
                const finalSuggestions = sorted
                    .map(entry => entry[0])
                    .filter(tag => !existingHashtags.includes(tag));

                resultDiv.innerHTML = `
                    ✅ Génération réussie!<br>
                    <strong>Texte analysé:</strong> "${text}"<br>
                    <strong>Mots-clés NLP:</strong> ${keywordsFromNLP.join(', ')}<br>
                    <strong>Hashtags suggérés:</strong> ${finalSuggestions.map(tag => '#' + tag).join(' ')}<br>
                    <strong>Nombre total:</strong> ${finalSuggestions.length}
                `;
            } catch (error) {
                resultDiv.innerHTML = `❌ Erreur: ${error.message}`;
            }
        }
    </script>
</body>
</html>